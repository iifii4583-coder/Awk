name: CyberLynx OS - OnurTools Master Fixed

on:
  workflow_dispatch:

jobs:
  build-iso:
    runs-on: ubuntu-latest
    steps:
      - name: üõ∞Ô∏è Checkout Repository
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Install Toolchain (Hatasƒ±z Paketler)
        run: |
          sudo apt-get update -y
          sudo apt-get install -y \
            build-essential bc bison flex libssl-dev libelf-dev \
            qemu-utils arch-install-scripts wget kmod cpio xorriso \
            grub-pc-bin grub-common mtools squashfs-tools

      - name: üß† Build CyberLynx Kernel (v6.6)
        run: |
          wget https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-6.6.10.tar.xz
          tar -xf linux-6.6.10.tar.xz
          cd linux-6.6.10
          make defconfig
          scripts/config --set-str CONFIG_LOCALVERSION "-CyberLynx-OS"
          # Grafik desteƒüi i√ßin gerekli ayarlar
          scripts/config --enable CONFIG_FB_EFI
          scripts/config --enable CONFIG_DRM_FBDEV_EMULATION
          make -j$(nproc) bzImage
          cd ..
          mkdir -p iso_root/boot/grub/themes/cyberlynx
          cp linux-6.6.10/arch/x86/boot/bzImage iso_root/boot/vmlinuz-cyberlynx

      - name: üñºÔ∏è Set BootSplash (Logo)
        run: |
          # Logonu indir ve GRUB temasƒ±na ekle
          wget -O iso_root/boot/grub/themes/cyberlynx/splash.png "https://raw.githubusercontent.com/iifii4583-coder/Awk/refs/heads/main/1768655851489.png"

      - name: üß∞ Build BusyBox Rootfs
        run: |
          mkdir -p rootfs/{bin,sbin,etc,proc,sys,dev,usr/bin,home/cyberlynx/Desktop,var/lib/pacman,etc/pacman.d}
          wget https://busybox.net/downloads/busybox-1.36.1.tar.bz2
          tar -xf busybox-1.36.1.tar.bz2
          cd busybox-1.36.1
          make defconfig
          sed -i 's/# CONFIG_STATIC is not set/CONFIG_STATIC=y/' .config
          make -j$(nproc) install
          cp -r _install/* ../rootfs/
          cd ..

      - name: üõ†Ô∏è Create Stealth Hacking App (Logosuz)
        run: |
          # Hacking Men√º Scripti
          cat <<EOF > rootfs/usr/bin/cyber-app
          #!/bin/sh
          clear
          echo "======================================================"
          echo "         CYBERLYNX STEALTH INTERFACE v1.0            "
          echo "             POWERED BY ONURTOOLS                    "
          echo "======================================================"
          echo " [1] Net-Scan [2] Web-Attack [3] Cracking [4] Update"
          echo "======================================================"
          read -p "Select: " opt
          case \$opt in
            1) xterm -e "pacman -S --noconfirm nmap && nmap -A 127.0.0.1; read" ;;
            2) xterm -e "pacman -S --noconfirm sqlmap && sqlmap -h; read" ;;
            3) xterm -e "pacman -S --noconfirm john; read" ;;
            4) xterm -e "pacman -Syu --noconfirm; read" ;;
          esac
          EOF
          chmod +x rootfs/usr/bin/cyber-app

          # Masa√ºst√º Kƒ±sayolu (Logosuz Metin Tabanlƒ±)
          cat <<EOF > rootfs/home/cyberlynx/Desktop/CyberInterface.desktop
          [Desktop Entry]
          Name=Cyber Interface
          Exec=cyber-app
          Icon=utilities-terminal
          Terminal=true
          Type=Application
          EOF
          chmod +x rootfs/home/cyberlynx/Desktop/CyberInterface.desktop

      - name: üè¥‚Äç‚ò†Ô∏è Pure CyberLynx Repo Config
        run: |
          cat <<EOF > rootfs/etc/pacman.conf
          [options]
          HoldPkg = pacman glibc
          Architecture = auto
          SigLevel = Never
          [cyberlynx-core]
          Server = https://mirror.rackspace.com/blackarch/\$repo/os/\$arch
          EOF
          echo "CyberLynx" > rootfs/etc/hostname

      - name: üíø Build Initramfs & ISO
        run: |
          # Init Script
          cat <<EOF > rootfs/etc/init.d/rcS
          #!/bin/sh
          mount -t proc none /proc
          mount -t sysfs none /sys
          /sbin/mdev -s
          startxfce4
          EOF
          chmod +x rootfs/etc/init.d/rcS
          
          # Initramfs Paketleme
          cd rootfs && find . | cpio -H newc -o | gzip > ../iso_root/boot/initrd-cyberlynx.img && cd ..
          
          # GRUB Splash Config
          cat <<EOF > iso_root/boot/grub/grub.cfg
          insmod png
          set timeout=5
          background_image /boot/grub/themes/cyberlynx/splash.png
          set menu_color_normal=white/black
          set menu_color_highlight=cyan/black
          menuentry "CyberLynx OS (OnurTools)" {
              linux /boot/vmlinuz-cyberlynx quiet splash
              initrd /boot/initrd-cyberlynx.img
          }
          EOF
          
          # ISO Olu≈üturma
          grub-mkrescue -o CyberLynx-OnurTools.iso iso_root

      - name: üì¶ Upload Final ISO
        uses: actions/upload-artifact@v4
        with:
          name: CyberLynx-Final-ISO
          path: CyberLynx-OnurTools.iso
          
